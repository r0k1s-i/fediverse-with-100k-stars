# Postmortem Report: UI 重叠与音频自动播放策略冲突

**事故编号**: INC-017
**严重级别**: P2 (Medium - 用户体验受损)
**发生时间**: 2026-01-12
**影响时长**: ~2小时
**负责人**: r0k1s#i
**状态**: ✅ 已解决

---

## 执行摘要

本报告分析了两个影响用户体验的 UI/交互问题：Minimap 与其他 UI 元素的重叠，以及背景音乐在现代浏览器中因自动播放策略被阻止的问题。

---

## 事故详情

### 1. UI 重叠问题
- **现象**: Minimap 面板底部与 Grid View 图标或底部状态栏重叠，导致部分按钮无法点击。
- **原因**: 固定的 `padding` 值（40px）不足以适应新的 UI 布局变化。此外，事件冒泡机制导致点击 Minimap 时可能误触发下层元素，或点击详情页时事件被吞噬导致 Minimap 不更新。
- **修复**: 
  - 增加底部内边距至 60px (commit `7deadd2`)
  - 使用 `capture: true` 确保交互事件在捕获阶段被处理，防止被子元素（如详情面板）阻止冒泡。

### 2. 音频自动播放失败
- **现象**: 用户打开页面后背景音乐未播放，控制台显示 "Autoplay prevented by browser policy"。
- **原因**: Chrome 等浏览器禁止带声音的媒体自动播放，必须由用户交互（点击、按键）触发。
- **修复**: 
  - 添加一次性事件监听器 (`once: true`) 监听 `click`, `touchstart`, `keydown`。
  - 在用户首次交互时调用 `play()`。
  - Commit: `b423e17`

---

## 经验教训

### 技术层面
1. **移动端适配**: UI 布局不能依赖死板的像素值，应考虑不同分辨率和动态内容高度。
2. **浏览器策略**: 必须时刻关注浏览器安全策略（如 Autoplay Policy）的变化，不能假设功能永远可用。
3. **DOM 事件流**: 熟练使用 `capture`（捕获）和 `bubble`（冒泡）阶段来解决复杂的交互冲突。

### 改进建议
- **UI 布局**: 迁移至 Flexbox/Grid 布局，减少手动 JavaScript 计算位置。
- **状态管理**: 音频播放状态应有 UI 反馈（如静音/播放按钮状态同步）。
